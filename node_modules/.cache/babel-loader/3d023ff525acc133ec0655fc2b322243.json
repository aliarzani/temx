{"ast":null,"code":"import _classCallCheck from \"/workspaces/codespaces-blank/baseapp-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/workspaces/codespaces-blank/baseapp-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/workspaces/codespaces-blank/baseapp-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/workspaces/codespaces-blank/baseapp-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/workspaces/codespaces-blank/baseapp-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/workspaces/codespaces-blank/baseapp-master/src/containers/OrdersElement/index.tsx\";\nimport { CloseButton, Decimal, Loader, Pagination } from '@openware/components';\nimport * as React from 'react';\nimport { FormattedMessage, injectIntl } from 'react-intl';\nimport { connect } from 'react-redux';\nimport { History } from '../../components';\nimport { localeDate, setTradeColor } from '../../helpers';\nimport { ordersHistoryCancelFetch as _ordersHistoryCancelFetch, selectCancelAllFetching, selectCancelFetching, selectCurrentPageIndex, selectMarkets, selectOrdersFirstElemIndex, selectOrdersHistory, selectOrdersHistoryLoading, selectOrdersLastElemIndex, selectOrdersNextPageExists, selectTotalOrdersHistory, userOrdersHistoryFetch as _userOrdersHistoryFetch } from '../../modules';\n\nvar OrdersComponent =\n/*#__PURE__*/\nfunction (_React$PureComponent) {\n  _inherits(OrdersComponent, _React$PureComponent);\n\n  function OrdersComponent() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, OrdersComponent);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(OrdersComponent)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _this.renderContent = function (list) {\n      var _this$props = _this.props,\n          firstElemIndex = _this$props.firstElemIndex,\n          lastElemIndex = _this$props.lastElemIndex,\n          total = _this$props.total,\n          pageIndex = _this$props.pageIndex,\n          nextPageExists = _this$props.nextPageExists;\n      return React.createElement(React.Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81\n        },\n        __self: this\n      }, React.createElement(History, {\n        headers: _this.renderHeaders(),\n        data: _this.retrieveData(list),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      }), React.createElement(Pagination, {\n        firstElemIndex: firstElemIndex,\n        lastElemIndex: lastElemIndex,\n        total: total,\n        page: pageIndex,\n        nextPageExists: nextPageExists,\n        onClickPrevPage: _this.onClickPrevPage,\n        onClickNextPage: _this.onClickNextPage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      }));\n    };\n\n    _this.onClickPrevPage = function () {\n      var _this$props2 = _this.props,\n          pageIndex = _this$props2.pageIndex,\n          type = _this$props2.type;\n\n      _this.props.userOrdersHistoryFetch({\n        pageIndex: Number(pageIndex) - 1,\n        type: type,\n        limit: 25\n      });\n    };\n\n    _this.onClickNextPage = function () {\n      var _this$props3 = _this.props,\n          pageIndex = _this$props3.pageIndex,\n          type = _this$props3.type;\n\n      _this.props.userOrdersHistoryFetch({\n        pageIndex: Number(pageIndex) + 1,\n        type: type,\n        limit: 25\n      });\n    };\n\n    _this.renderHeaders = function () {\n      return [_this.props.intl.formatMessage({\n        id: 'page.body.history.deposit.header.date'\n      }), _this.props.intl.formatMessage({\n        id: 'page.body.openOrders.header.orderType'\n      }), _this.props.intl.formatMessage({\n        id: 'page.body.openOrders.header.pair'\n      }), _this.props.intl.formatMessage({\n        id: 'page.body.openOrders.header.price'\n      }), _this.props.intl.formatMessage({\n        id: 'page.body.openOrders.header.amount'\n      }), _this.props.intl.formatMessage({\n        id: 'page.body.openOrders.header.executed'\n      }), _this.props.intl.formatMessage({\n        id: 'page.body.openOrders.header.remaining'\n      }), _this.props.intl.formatMessage({\n        id: 'page.body.openOrders.header.costRemaining'\n      }), _this.props.intl.formatMessage({\n        id: 'page.body.openOrders.header.status'\n      }), ''];\n    };\n\n    _this.retrieveData = function (list) {\n      return list.map(function (item) {\n        return _this.renderOrdersHistoryRow(item);\n      });\n    };\n\n    _this.renderOrdersHistoryRow = function (item) {\n      var id = item.id,\n          executed_volume = item.executed_volume,\n          market = item.market,\n          ord_type = item.ord_type,\n          price = item.price,\n          avg_price = item.avg_price,\n          remaining_volume = item.remaining_volume,\n          origin_volume = item.origin_volume,\n          side = item.side,\n          state = item.state,\n          updated_at = item.updated_at,\n          created_at = item.created_at;\n      var currentMarket = _this.props.marketsData.find(function (m) {\n        return m.id === market;\n      }) || {\n        name: '',\n        price_precision: 0,\n        amount_precision: 0\n      };\n\n      var orderType = _this.getType(side, ord_type);\n\n      var marketName = currentMarket ? currentMarket.name : market;\n      var costRemaining = remaining_volume * price; // price or avg_price ???\n\n      var date = localeDate(updated_at ? updated_at : created_at, 'fullDate');\n\n      var status = _this.setOrderStatus(state);\n\n      var actualPrice = ord_type === 'market' || status === 'done' ? avg_price : price;\n      return [date, React.createElement(\"span\", {\n        style: {\n          color: setTradeColor(side).color\n        },\n        key: id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152\n        },\n        __self: this\n      }, orderType), marketName, React.createElement(Decimal, {\n        key: id,\n        fixed: currentMarket.price_precision,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }, actualPrice), React.createElement(Decimal, {\n        key: id,\n        fixed: currentMarket.amount_precision,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155\n        },\n        __self: this\n      }, origin_volume), React.createElement(Decimal, {\n        key: id,\n        fixed: currentMarket.amount_precision,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156\n        },\n        __self: this\n      }, executed_volume), React.createElement(Decimal, {\n        key: id,\n        fixed: currentMarket.amount_precision,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }, remaining_volume), React.createElement(Decimal, {\n        key: id,\n        fixed: currentMarket.amount_precision,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }, costRemaining.toString()), status, state === 'wait' && React.createElement(CloseButton, {\n        key: id,\n        onClick: _this.handleCancel(id),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      })];\n    };\n\n    _this.getType = function (side, orderType) {\n      if (!side || !orderType) {\n        return '';\n      }\n\n      return _this.props.intl.formatMessage({\n        id: \"page.body.openOrders.header.orderType.\".concat(side, \".\").concat(orderType)\n      });\n    };\n\n    _this.setOrderStatus = function (status) {\n      switch (status) {\n        case 'done':\n          return React.createElement(\"span\", {\n            className: \"pg-history-elem-executed\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 175\n            },\n            __self: this\n          }, React.createElement(FormattedMessage, {\n            id: \"page.body.openOrders.content.status.done\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 176\n            },\n            __self: this\n          }));\n\n        case 'cancel':\n          return React.createElement(\"span\", {\n            className: \"pg-history-elem-canceled\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 181\n            },\n            __self: this\n          }, React.createElement(FormattedMessage, {\n            id: \"page.body.openOrders.content.status.cancel\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 182\n            },\n            __self: this\n          }));\n\n        case 'wait':\n          return React.createElement(\"span\", {\n            className: \"pg-history-elem-opened\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 187\n            },\n            __self: this\n          }, React.createElement(FormattedMessage, {\n            id: \"page.body.openOrders.content.status.wait\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 188\n            },\n            __self: this\n          }));\n\n        default:\n          return status;\n      }\n    };\n\n    _this.handleCancel = function (id) {\n      return function () {\n        var _this$props4 = _this.props,\n            cancelAllFetching = _this$props4.cancelAllFetching,\n            cancelFetching = _this$props4.cancelFetching,\n            type = _this$props4.type,\n            list = _this$props4.list;\n\n        if (cancelAllFetching || cancelFetching) {\n          return;\n        }\n\n        _this.props.ordersHistoryCancelFetch({\n          id: id,\n          type: type,\n          list: list\n        });\n      };\n    };\n\n    return _this;\n  }\n\n  _createClass(OrdersComponent, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var type = this.props.type;\n      this.props.userOrdersHistoryFetch({\n        pageIndex: 0,\n        type: type,\n        limit: 25\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props5 = this.props,\n          fetching = _this$props5.fetching,\n          type = _this$props5.type,\n          list = _this$props5.list;\n      var updateList = list;\n\n      if (type === 'open') {\n        updateList = list.filter(function (o) {\n          return o.state === 'wait';\n        });\n      }\n\n      var emptyMsg = this.props.intl.formatMessage({\n        id: 'page.noDataToShow'\n      });\n      return React.createElement(\"div\", {\n        className: \"pg-history-elem \".concat(updateList.length ? '' : 'pg-history-elem-empty'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 70\n        },\n        __self: this\n      }, fetching && React.createElement(Loader, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71\n        },\n        __self: this\n      }), updateList.length ? this.renderContent(updateList) : null, !updateList.length && !fetching ? React.createElement(\"p\", {\n        className: \"pg-history-elem__empty\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73\n        },\n        __self: this\n      }, emptyMsg) : null);\n    }\n  }]);\n\n  return OrdersComponent;\n}(React.PureComponent);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    marketsData: selectMarkets(state),\n    pageIndex: selectCurrentPageIndex(state),\n    firstElemIndex: selectOrdersFirstElemIndex(state, 25),\n    list: selectOrdersHistory(state),\n    fetching: selectOrdersHistoryLoading(state),\n    lastElemIndex: selectOrdersLastElemIndex(state, 25),\n    nextPageExists: selectOrdersNextPageExists(state, 25),\n    total: selectTotalOrdersHistory(state),\n    cancelAllFetching: selectCancelAllFetching(state),\n    cancelFetching: selectCancelFetching(state)\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    ordersHistoryCancelFetch: function ordersHistoryCancelFetch(payload) {\n      return dispatch(_ordersHistoryCancelFetch(payload));\n    },\n    userOrdersHistoryFetch: function userOrdersHistoryFetch(payload) {\n      return dispatch(_userOrdersHistoryFetch(payload));\n    }\n  };\n};\n\nexport var OrdersElement = injectIntl(connect(mapStateToProps, mapDispatchToProps)(OrdersComponent));","map":{"version":3,"sources":["/workspaces/codespaces-blank/baseapp-master/src/containers/OrdersElement/index.tsx"],"names":["CloseButton","Decimal","Loader","Pagination","React","FormattedMessage","injectIntl","connect","History","localeDate","setTradeColor","ordersHistoryCancelFetch","selectCancelAllFetching","selectCancelFetching","selectCurrentPageIndex","selectMarkets","selectOrdersFirstElemIndex","selectOrdersHistory","selectOrdersHistoryLoading","selectOrdersLastElemIndex","selectOrdersNextPageExists","selectTotalOrdersHistory","userOrdersHistoryFetch","OrdersComponent","renderContent","list","props","firstElemIndex","lastElemIndex","total","pageIndex","nextPageExists","renderHeaders","retrieveData","onClickPrevPage","onClickNextPage","type","Number","limit","intl","formatMessage","id","map","item","renderOrdersHistoryRow","executed_volume","market","ord_type","price","avg_price","remaining_volume","origin_volume","side","state","updated_at","created_at","currentMarket","marketsData","find","m","name","price_precision","amount_precision","orderType","getType","marketName","costRemaining","date","status","setOrderStatus","actualPrice","color","toString","handleCancel","cancelAllFetching","cancelFetching","fetching","updateList","filter","o","emptyMsg","length","PureComponent","mapStateToProps","mapDispatchToProps","dispatch","payload","OrdersElement"],"mappings":"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","sourcesContent":["import { CloseButton, Decimal, Loader, Pagination } from '@openware/components';\nimport * as React from 'react';\nimport { FormattedMessage, InjectedIntlProps, injectIntl } from 'react-intl';\nimport { connect, MapDispatchToPropsFunction } from 'react-redux';\nimport { History } from '../../components';\nimport { localeDate, setTradeColor } from '../../helpers';\nimport {\n    Market,\n    ordersHistoryCancelFetch,\n    RootState,\n    selectCancelAllFetching,\n    selectCancelFetching,\n    selectCurrentPageIndex,\n    selectMarkets,\n    selectOrdersFirstElemIndex,\n    selectOrdersHistory,\n    selectOrdersHistoryLoading,\n    selectOrdersLastElemIndex,\n    selectOrdersNextPageExists,\n    selectTotalOrdersHistory,\n    userOrdersHistoryFetch,\n} from '../../modules';\nimport { OrderCommon } from '../../modules/types';\n\ninterface OrdersProps {\n    type: string;\n}\n\ninterface ReduxProps {\n    marketsData: Market[];\n    pageIndex: number;\n    firstElemIndex: number;\n    list: OrderCommon[];\n    fetching: boolean;\n    lastElemIndex: number;\n    nextPageExists: boolean;\n    total: number;\n    cancelAllFetching: boolean;\n    cancelFetching: boolean;\n}\n\ninterface DispatchProps {\n    ordersHistoryCancelFetch: typeof ordersHistoryCancelFetch;\n    userOrdersHistoryFetch: typeof userOrdersHistoryFetch;\n}\n\ninterface OrdersState {\n    orderType: boolean;\n}\n\n\ntype Props = OrdersProps & ReduxProps & DispatchProps & InjectedIntlProps;\n\nclass OrdersComponent extends React.PureComponent<Props, OrdersState>  {\n    public componentDidMount() {\n        const { type } = this.props;\n        this.props.userOrdersHistoryFetch({ pageIndex: 0, type, limit: 25 });\n    }\n\n    public render() {\n        const { fetching, type, list } = this.props;\n        let updateList = list;\n\n        if (type === 'open') {\n            updateList = list.filter(o => o.state === 'wait');\n        }\n\n        const emptyMsg = this.props.intl.formatMessage({id: 'page.noDataToShow'});\n        return (\n            <div className={`pg-history-elem ${updateList.length ? '' : 'pg-history-elem-empty'}`}>\n                {fetching && <Loader />}\n                {updateList.length ? this.renderContent(updateList) : null}\n                {!updateList.length && !fetching ? <p className=\"pg-history-elem__empty\">{emptyMsg}</p> : null}\n            </div>\n        );\n    }\n\n    public renderContent = list => {\n        const { firstElemIndex, lastElemIndex, total, pageIndex, nextPageExists } = this.props;\n        return (\n            <React.Fragment>\n                <History headers={this.renderHeaders()} data={this.retrieveData(list)}/>\n                <Pagination\n                    firstElemIndex={firstElemIndex}\n                    lastElemIndex={lastElemIndex}\n                    total={total}\n                    page={pageIndex}\n                    nextPageExists={nextPageExists}\n                    onClickPrevPage={this.onClickPrevPage}\n                    onClickNextPage={this.onClickNextPage}\n                />\n            </React.Fragment>\n        );\n    };\n\n    private onClickPrevPage = () => {\n        const { pageIndex, type } = this.props;\n        this.props.userOrdersHistoryFetch({ pageIndex: Number(pageIndex) - 1, type, limit: 25 });\n    };\n\n    private onClickNextPage = () => {\n        const { pageIndex, type } = this.props;\n        this.props.userOrdersHistoryFetch({ pageIndex: Number(pageIndex) + 1, type, limit: 25 });\n    };\n\n    private renderHeaders = () => {\n        return [\n            this.props.intl.formatMessage({ id: 'page.body.history.deposit.header.date' }),\n            this.props.intl.formatMessage({ id: 'page.body.openOrders.header.orderType' }),\n            this.props.intl.formatMessage({ id: 'page.body.openOrders.header.pair' }),\n            this.props.intl.formatMessage({ id: 'page.body.openOrders.header.price' }),\n            this.props.intl.formatMessage({ id: 'page.body.openOrders.header.amount' }),\n            this.props.intl.formatMessage({ id: 'page.body.openOrders.header.executed' }),\n            this.props.intl.formatMessage({ id: 'page.body.openOrders.header.remaining' }),\n            this.props.intl.formatMessage({ id: 'page.body.openOrders.header.costRemaining' }),\n            this.props.intl.formatMessage({ id: 'page.body.openOrders.header.status' }),\n            '',\n        ];\n    };\n\n    private retrieveData = list => {\n        return list.map(item => this.renderOrdersHistoryRow(item));\n    };\n\n    private renderOrdersHistoryRow = item => {\n        const {\n            id,\n            executed_volume,\n            market,\n            ord_type,\n            price,\n            avg_price,\n            remaining_volume,\n            origin_volume,\n            side,\n            state,\n            updated_at,\n            created_at,\n        } = item;\n        const currentMarket = this.props.marketsData.find(m => m.id === market)\n            || { name: '', price_precision: 0, amount_precision: 0 };\n\n        const orderType = this.getType(side, ord_type);\n        const marketName = currentMarket ? currentMarket.name : market;\n        const costRemaining = remaining_volume * price; // price or avg_price ???\n        const date = localeDate(updated_at ? updated_at : created_at, 'fullDate');\n        const status = this.setOrderStatus(state);\n        const actualPrice = ord_type === 'market' || status === 'done' ? avg_price : price;\n\n        return [\n            date,\n            <span style={{ color: setTradeColor(side).color }} key={id}>{orderType}</span>,\n            marketName,\n            <Decimal key={id} fixed={currentMarket.price_precision}>{actualPrice}</Decimal>,\n            <Decimal key={id} fixed={currentMarket.amount_precision}>{origin_volume}</Decimal>,\n            <Decimal key={id} fixed={currentMarket.amount_precision}>{executed_volume}</Decimal>,\n            <Decimal key={id} fixed={currentMarket.amount_precision}>{remaining_volume}</Decimal>,\n            <Decimal key={id} fixed={currentMarket.amount_precision}>{costRemaining.toString()}</Decimal>,\n            status,\n            state === 'wait' && <CloseButton key={id} onClick={this.handleCancel(id)} />,\n        ];\n    };\n\n    private getType = (side: string, orderType: string) => {\n        if (!side || !orderType) {\n            return '';\n        }\n        return this.props.intl.formatMessage({ id: `page.body.openOrders.header.orderType.${side}.${orderType}` });\n    };\n\n    private setOrderStatus = (status: string) => {\n        switch (status) {\n            case 'done':\n                return (\n                    <span className=\"pg-history-elem-executed\">\n                        <FormattedMessage id={`page.body.openOrders.content.status.done`} />\n                    </span>\n                );\n            case 'cancel':\n                return (\n                    <span className=\"pg-history-elem-canceled\">\n                        <FormattedMessage id={`page.body.openOrders.content.status.cancel`} />\n                    </span>\n                );\n            case 'wait':\n                return (\n                    <span className=\"pg-history-elem-opened\">\n                        <FormattedMessage id={`page.body.openOrders.content.status.wait`} />\n                    </span>\n                );\n            default:\n                return status;\n        }\n    };\n\n    private handleCancel = (id: number) => () => {\n        const { cancelAllFetching, cancelFetching, type, list } = this.props;\n        if (cancelAllFetching || cancelFetching) {\n            return;\n        }\n        this.props.ordersHistoryCancelFetch({ id, type, list });\n    };\n}\n\nconst mapStateToProps = (state: RootState): ReduxProps => ({\n    marketsData: selectMarkets(state),\n    pageIndex: selectCurrentPageIndex(state),\n    firstElemIndex: selectOrdersFirstElemIndex(state, 25),\n    list: selectOrdersHistory(state),\n    fetching: selectOrdersHistoryLoading(state),\n    lastElemIndex: selectOrdersLastElemIndex(state, 25),\n    nextPageExists: selectOrdersNextPageExists(state, 25),\n    total: selectTotalOrdersHistory(state),\n    cancelAllFetching: selectCancelAllFetching(state),\n    cancelFetching: selectCancelFetching(state),\n});\n\nconst mapDispatchToProps: MapDispatchToPropsFunction<DispatchProps, {}> =\n    dispatch => ({\n        ordersHistoryCancelFetch: payload => dispatch(ordersHistoryCancelFetch(payload)),\n        userOrdersHistoryFetch: payload => dispatch(userOrdersHistoryFetch(payload)),\n    });\n\nexport const OrdersElement = injectIntl(connect(mapStateToProps, mapDispatchToProps)(OrdersComponent));\n"]},"metadata":{},"sourceType":"module"}